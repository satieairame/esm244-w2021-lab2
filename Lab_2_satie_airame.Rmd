---
title: "ESM 244 Lab Week 2"
author: "Satie Airame"
date: "1/13/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(janitor)
library(palmerpenguins)
library(here)

## For PCA
library(ggfortify)

## For ggplot customization:
library(readxl) # read excel files
library(gghighlight) # highlight series or groups we specify based on values or strings
library(lubridate)
library(plotly)

# To make compound figures:
library(patchwork)
```

## Part 1: PCA with penguins

```{r}
penguin_pca <- penguins %>% 
  select(body_mass_g, ends_with("_mm")) %>% # To select several columns that all end with a particular string, e.g., _mm
  drop_na() %>% # To remove NA
  scale() %>% # To take the data and put in all on similar scales
  prcomp() # To create a PCA outcome

penguin_pca$rotation # Bring up loadings for each of the PCA, what are the loadings for the variable, e.g., rotation

# Type ?scale and ?autoplot in the Console to learn more about these functions

# Make a new dataset with the observations that exist, match the observations that were used to create this PCA biplot but still contain the other variables.

penguin_complete <- penguins %>% 
  drop_na(body_mass_g, ends_with("_mm")) # make new dataset from penguins that has the exact same observations used in the PCA but also has the other variables

autoplot(penguin_pca,
         data = penguin_complete,
         colour = "species", # use other dataset for the aesthetics 
         loadings = TRUE, # add loadings (arrows)
         loadings.label = TRUE) + # add labels for the loadings, can customize the location of labels so they don't overlap
  theme_minimal()

```

### Part 2: ggplot customization & reading in different file types

#### Read in an .xlsx file & do some wrangling

```{r}
fish_noaa <- read_excel(here("data", "foss_landings.xlsx")) %>% 
  clean_names() %>% # default to convert titles to lower snake case
  mutate(across(where(is.character), tolower)) %>% # workhorse for how to transform existing columns, mutate columns across whatever columns are a character class and covert to lowercase, across or ends_with or starts_with are helper functions
  mutate(nmfs_name = str_sub(nmfs_name, end = - 4)) %>% # string sub extracts or replaces substrings from a character vector, put in the same column (replace) 
  filter(confidentiality == "public")
```

Make a customized graph:


```{r}
fish_plot <- ggplot(data = fish_noaa, aes(x=year, y=pounds)) +
  geom_line(aes(color = nmfs_name), show.legend = FALSE) +
  theme_minimal()
fish_plot

ggplotly(fish_plot) # to create an interactive graph
# lots of overlapping lines is spaghetti plot


```

```{r}
#### Use gghighlight to highlight certain series

ggplot(data = fish_noaa, aes(x=year, y=pounds, group = nmfs_name)) +
  geom_line() +
  theme_minimal() +
  gghighlight(nmfs_name == "tunas") # to highlight tunas by itself (in black)
```

```{r}
#### Use gghighlight to highlight certain series with specific value

ggplot(data = fish_noaa, aes(x=year, y=pounds, group = nmfs_name)) +
  geom_line(aes(color = nmfs_name)) + # assumes only want to apply color scheme to the series that highlight the gghighlight specifications, still grays out the other series
  theme_minimal() +
  gghighlight(max(pounds) > 1e8) # highlight where maximum value exceeds 10^8
```

#### Read in data from URL, 'lubridate()', 'mutate()', make a graph with months in logical order

```{r}

```





